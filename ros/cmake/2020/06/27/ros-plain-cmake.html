<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>ROS Plain CMake | ü§ñ Tim √úbelh√∂rs blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="ROS Plain CMake" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Tutorial on creating a plain CMake package without any ROS dependencies that can be used with ROS." />
<meta property="og:description" content="Tutorial on creating a plain CMake package without any ROS dependencies that can be used with ROS." />
<link rel="canonical" href="https://tuebel.github.io/blog/ros/cmake/2020/06/27/ros-plain-cmake.html" />
<meta property="og:url" content="https://tuebel.github.io/blog/ros/cmake/2020/06/27/ros-plain-cmake.html" />
<meta property="og:site_name" content="ü§ñ Tim √úbelh√∂rs blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-27T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Tutorial on creating a plain CMake package without any ROS dependencies that can be used with ROS.","@type":"BlogPosting","headline":"ROS Plain CMake","dateModified":"2020-06-27T00:00:00-05:00","datePublished":"2020-06-27T00:00:00-05:00","url":"https://tuebel.github.io/blog/ros/cmake/2020/06/27/ros-plain-cmake.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://tuebel.github.io/blog/ros/cmake/2020/06/27/ros-plain-cmake.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/blog/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://tuebel.github.io/blog/feed.xml" title="ü§ñ Tim √úbelh√∂rs blog" /><link rel="shortcut icon" type="image/x-icon" href="/blog/images/favicon.ico"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>ROS Plain CMake | ü§ñ Tim √úbelh√∂rs blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="ROS Plain CMake" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Tutorial on creating a plain CMake package without any ROS dependencies that can be used with ROS." />
<meta property="og:description" content="Tutorial on creating a plain CMake package without any ROS dependencies that can be used with ROS." />
<link rel="canonical" href="https://tuebel.github.io/blog/ros/cmake/2020/06/27/ros-plain-cmake.html" />
<meta property="og:url" content="https://tuebel.github.io/blog/ros/cmake/2020/06/27/ros-plain-cmake.html" />
<meta property="og:site_name" content="ü§ñ Tim √úbelh√∂rs blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-06-27T00:00:00-05:00" />
<script type="application/ld+json">
{"description":"Tutorial on creating a plain CMake package without any ROS dependencies that can be used with ROS.","@type":"BlogPosting","headline":"ROS Plain CMake","dateModified":"2020-06-27T00:00:00-05:00","datePublished":"2020-06-27T00:00:00-05:00","url":"https://tuebel.github.io/blog/ros/cmake/2020/06/27/ros-plain-cmake.html","mainEntityOfPage":{"@type":"WebPage","@id":"https://tuebel.github.io/blog/ros/cmake/2020/06/27/ros-plain-cmake.html"},"@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet" />
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css"><link type="application/atom+xml" rel="alternate" href="https://tuebel.github.io/blog/feed.xml" title="ü§ñ Tim √úbelh√∂rs blog" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head><body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/blog/">ü§ñ Tim √úbelh√∂rs blog</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/blog/about/">About Me</a><a class="page-link" href="/blog/search/">Search</a><a class="page-link" href="/blog/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">ROS Plain CMake</h1><p class="page-description">Tutorial on creating a plain CMake package without any ROS dependencies that can be used with ROS.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-06-27T00:00:00-05:00" itemprop="datePublished">
        Jun 27, 2020
      </time>
       ‚Ä¢ <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#ROS">ROS</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#CMake">CMake</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#motivation">Motivation</a></li>
<li class="toc-entry toc-h1"><a href="#example-repository">Example repository</a></li>
<li class="toc-entry toc-h1"><a href="#packagexml">package.xml</a></li>
<li class="toc-entry toc-h1"><a href="#cmakeliststxt">CMakeLists.txt</a>
<ul>
<li class="toc-entry toc-h2"><a href="#basic-configuration">Basic configuration</a></li>
<li class="toc-entry toc-h2"><a href="#defining-targets">Defining targets</a></li>
<li class="toc-entry toc-h2"><a href="#config-generation">Config generation</a></li>
<li class="toc-entry toc-h2"><a href="#installation">Installation</a></li>
<li class="toc-entry toc-h2"><a href="#building-the-project">Building the Project</a></li>
<li class="toc-entry toc-h2"><a href="#references">References</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#todo">TODO</a></li>
</ul><h1 id="motivation">
<a class="anchor" href="#motivation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Motivation</h1>
<p>Even though it is considered best practice to separate the ROS code from the logic, they are commonly placed in the same ROS package.
To increase the reusability, the logic should be placed in a different package which does not rely on the ROS bits.
This enables the community or colleagues to use the code in non-ROS projects.
However, this requires the programmer to manually add the packaging magic that catkin would do.
This blog post is meant to provide some insight on what is required to make a CMake project ‚Äòfind_packagable‚Äô to enable:</p>
<ul>
  <li>
<code class="highlighter-rouge">find_package</code> in a ROS workspace</li>
  <li>
<code class="highlighter-rouge">find_package</code> as a system dependency</li>
  <li>importing targets and forwarding their dependencies</li>
</ul>

<h1 id="example-repository">
<a class="anchor" href="#example-repository" aria-hidden="true"><span class="octicon octicon-link"></span></a>Example repository</h1>
<p>A minimal working example of a ROS workspace can be found <a href="https://github.com/Tuebel/ros_plain_cmake">here</a>.
This workspace contrains three packages:</p>
<ol>
  <li>
<a href="https://github.com/Tuebel/ros_plain_cmake/tree/master/src/catkin_pkg">catkin_pkg</a>: test the plain_cmake package in a ROS workspace</li>
  <li>
<a href="https://github.com/Tuebel/ros_plain_cmake/tree/master/src/consumer_cmake">consumer_cmake</a>: test the system installation of plain_cmake in another CMake project</li>
  <li>
<a href="https://github.com/Tuebel/ros_plain_cmake/tree/master/src/plain_cmake">plain_cmake</a>: minimal example of a plain CMake package for ROS
This blog post will fokus on the plain_cmake package.</li>
</ol>

<p>Importing the package into another CMake or catkin package is straight forward and tutorials can be found in the <a href="http://wiki.ros.org/catkin/Tutorials/CreatingPackage">ROS wiki</a>.</p>

<h1 id="packagexml">
<a class="anchor" href="#packagexml" aria-hidden="true"><span class="octicon octicon-link"></span></a>package.xml</h1>
<p>Even though a <code class="highlighter-rouge">package.xml</code> is not required for the CMake functionalities, it is still required in the context of ROS.
This file gets parsed by the build tool to determine the dependencies and the build order.
To mark our project as plain CMake we add the following tags to our <code class="highlighter-rouge">package.xml</code>:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;buildtool_depend&gt;</span>cmake<span class="nt">&lt;/buildtool_depend&gt;</span>

<span class="nt">&lt;exports&gt;</span>
  <span class="nt">&lt;build_type&gt;</span>cmake<span class="nt">&lt;/build_type&gt;</span>
<span class="nt">&lt;/exports&gt;</span>
</code></pre></div></div>
<p>Many dependencies can be installed via <a href="http://wiki.ros.org/rosdep">rosdep</a> so they should be added, too.
Make sure to visit <a href="http://rosindex.github.io/">rosindex</a> to find the correct name of the dependencies.
For example for linear algebra, matrix and vector operations the package could depend on <a href="http://eigen.tuxfamily.org/">Eigen</a>:</p>
<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;depend&gt;</span>eigen<span class="nt">&lt;/depend&gt;</span>
</code></pre></div></div>

<h1 id="cmakeliststxt">
<a class="anchor" href="#cmakeliststxt" aria-hidden="true"><span class="octicon octicon-link"></span></a>CMakeLists.txt</h1>
<h2 id="basic-configuration">
<a class="anchor" href="#basic-configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Basic configuration</h2>
<p>First, some basic configuration variables are set for the package.
We will use some modern features which require CMake version 3.0 or higher.
Moreover, we define a name and version for the package.</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cmake_minimum_required</span><span class="p">(</span>VERSION 3.0<span class="p">)</span>
<span class="nb">project</span><span class="p">(</span>plain_cmake<span class="p">)</span>
<span class="nb">set</span><span class="p">(</span>PLAIN_CMAKE_VERSION 0.1<span class="p">)</span>
</code></pre></div></div>
<p>Now we include some CMake helpers which provide default installation locations and helpers to generate the CMake configuration.</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">include</span><span class="p">(</span>GNUInstallDirs<span class="p">)</span>
<span class="nb">include</span><span class="p">(</span>CMakePackageConfigHelpers<span class="p">)</span>
</code></pre></div></div>
<p>Finally, we need to include the dependencies of our package.
In this example, the Eigen3 library is required.</p>
<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">find_package</span> <span class="p">(</span>Eigen3 3.3 REQUIRED NO_MODULE<span class="p">)</span>
</code></pre></div></div>

<h2 id="defining-targets">
<a class="anchor" href="#defining-targets" aria-hidden="true"><span class="octicon octicon-link"></span></a>Defining targets</h2>
<p>This step is very similar to defining targets in a catkin package.
In this example, we define a library named after project which consists of a single source file.
The only difference ‚Ä¶</p>

<div class="language-cmake highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">add_library</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_PROJECT_NAME</span><span class="si">}</span>_lib src/matrix_operations.cpp<span class="p">)</span>
<span class="c1"># different locations on build and after install</span>
<span class="nb">target_include_directories</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_PROJECT_NAME</span><span class="si">}</span>_lib PUBLIC
  $&lt;BUILD_INTERFACE:<span class="si">${</span><span class="nv">CMAKE_CURRENT_SOURCE_DIR</span><span class="si">}</span>/include&gt;
  $&lt;INSTALL_INTERFACE:include&gt;<span class="p">)</span>
<span class="nb">target_link_libraries</span><span class="p">(</span><span class="si">${</span><span class="nv">CMAKE_PROJECT_NAME</span><span class="si">}</span>_lib PUBLIC Eigen3::Eigen<span class="p">)</span>
</code></pre></div></div>

<h2 id="config-generation">
<a class="anchor" href="#config-generation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Config generation</h2>
<p>Both, the <code class="highlighter-rouge">plain_cmakeConfigVersion.cmake</code> and the <code class="highlighter-rouge">plain_cmakeConfig.cmake</code> are required for the <code class="highlighter-rouge">find_package</code> functionality.</p>

<h2 id="installation">
<a class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>
<ul>
  <li>Build in source tree</li>
  <li>Build out of source tree</li>
</ul>

<h2 id="building-the-project">
<a class="anchor" href="#building-the-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building the Project</h2>

<h2 id="references">
<a class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h2>

<h1 id="todo">
<a class="anchor" href="#todo" aria-hidden="true"><span class="octicon octicon-link"></span></a>TODO</h1>
<ul>
  <li>Plain CMake packages cannot be compiled via <code class="highlighter-rouge">catkin_make</code> <sup id="fnref:1"><a href="#fn:1" class="footnote">1</a></sup>.</li>
  <li>Having ROS dependencies requires catkin anyways.</li>
  <li>Use inclusive ‚Äúwe‚Äù</li>
  <li>
</ul>
<div class="footnotes">
  <ol>
    <li id="fn:1">
      <p>[https://www.ros.org/reps/rep-0134.html]¬†<a href="#fnref:1" class="reversefootnote">‚Ü©</a></p>
    </li>
  </ol>
</div>

  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="Tuebel/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/ros/cmake/2020/06/27/ros-plain-cmake.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/blog/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/blog/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Hacks, tricks and awesomeness for robots and you. GoROS!</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/Tuebel" title="Tuebel"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/TimUebelhoer" title="TimUebelhoer"><svg class="svg-icon grey"><use xlink:href="/blog/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
